<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admissions Enquiry | Maaref American School</title>

  <!-- Styles -->
  <link rel="stylesheet" href="assets/styles.css">
  <link rel="icon" type="image/x-icon" href="assets/images/logo/favicon_io/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/images/logo/favicon_io/apple-touch-icon.png">
  <link rel="icon" sizes="32x32" href="assets/images/logo/favicon_io/favicon-32x32.png" type="image/png">
  <link rel="icon" sizes="192x192" href="assets/images/logo/favicon_io/android-chrome-192x192.png" type="image/png">

  <!-- Libraries -->
  <script src="https://unpkg.com/htmx.org@1.9.6"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white font-[Playfair_Display]">

  <!-- Navbar partial -->
  <div hx-get="partials/navbarv1.html" hx-trigger="load" hx-swap="outerHTML"></div>

  <!-- Hero Section -->
  <section class="relative h-[70vh] -mt-[160px] bg-cover bg-center flex items-center justify-center pt-40"
    style="background-image: url('assets/images/term_dates_cover_photo.webp');">
    <div class="absolute inset-0 bg-black bg-opacity-50"></div>
    <div class="relative z-10 flex items-center justify-center h-full text-white">
      <h1 class="text-4xl md:text-5xl font-bold">Admissions Enquiry</h1>
    </div>
  </section>

  <!-- Contact Section -->
  <section class="bg-white py-12 px-6 md:px-16 text-black">
    <div class="max-w-6xl mx-auto">
      <p class="mb-8 text-lg">
        Interested in enrolling your child at our school? Please complete the form below. Our Admissions Team will contact you shortly with the next steps.
      </p>

      <!-- Netlify Form (AJAX) -->
      <form id="admissionsForm" name="admissions-enquiry"
            method="POST"
            data-netlify="true"
            netlify-honeypot="bot-field"
            action="/thank-you.html"
            class="grid md:grid-cols-2 gap-6">

        <input type="hidden" name="form-name" value="admissions-enquiry" />

        <p hidden>
          <label>Donâ€™t fill this out if you're human: <input name="bot-field" /></label>
        </p>

        <div>
          <label for="parentName" class="block mb-1 font-semibold">Parent Name</label>
          <input type="text" id="parentName" name="parentName" required class="w-full border px-4 py-2 rounded" />
        </div>

        <div>
          <label for="studentName" class="block mb-1 font-semibold">Student Name</label>
          <input type="text" id="studentName" name="studentName" required class="w-full border px-4 py-2 rounded" />
        </div>

        <div>
          <label for="studentDOB" class="block mb-1 font-semibold">Student's Date of Birth</label>
          <input type="date" id="studentDOB" name="studentDOB" required class="w-full border px-4 py-2 rounded" />
        </div>

        <div>
          <label for="grade" class="block mb-1 font-semibold">Grade</label>
          <select id="grade" name="grade" required class="w-full border px-4 py-2 rounded">
            <option value="">Select Grade</option>
            <option value="Pre-KG">Pre-KG</option>
            <option value="KG1">KG1</option>
            <option value="KG2">KG2</option>
            <option value="Grade 1">Grade 1</option>
            <option value="Grade 2">Grade 2</option>
            <option value="Grade 3">Grade 3</option>
            <option value="Grade 4">Grade 4</option>
            <option value="Grade 5">Grade 5</option>
            <option value="Grade 6">Grade 6</option>
            <option value="Grade 7">Grade 7</option>
            <option value="Grade 8">Grade 8</option>
            <option value="Grade 9">Grade 9</option>
            <option value="Grade 10">Grade 10</option>
            <option value="Grade 11">Grade 11</option>
            <option value="Grade 12">Grade 12</option>
          </select>
        </div>

        <div>
          <label for="lastSchool" class="block mb-1 font-semibold">Last School Attended</label>
          <input type="text" id="lastSchool" name="lastSchool" class="w-full border px-4 py-2 rounded" />
        </div>

        <div>
          <label for="lastGrade" class="block mb-1 font-semibold">Last Grade Attended</label>
          <input type="text" id="lastGrade" name="lastGrade" class="w-full border px-4 py-2 rounded" />
        </div>

        <div>
          <label for="parentPhone" class="block mb-1 font-semibold">Parent Contact Number</label>
          <input type="tel" id="parentPhone" name="parentPhone" pattern="[0-9]{9,15}" placeholder="971 50 123 4567" required class="w-full border px-4 py-2 rounded" />
        </div>

        <div>
          <label for="parentEmail" class="block mb-1 font-semibold">Parent Email</label>
          <input type="email" id="parentEmail" name="parentEmail" required class="w-full border px-4 py-2 rounded" />
        </div>

        <!-- Academic Year -->
        <div>
          <label for="academicYear" class="block mb-1 font-semibold">Academic Year</label>
          <select id="academicYear" name="academicYear" required class="w-full border px-4 py-2 rounded">
            <option value="">Select Academic Year</option>
            <option value="2025-2026">2025-2026</option>
            <option value="2026-2027">2026-2027</option>
          </select>
        </div>

        <!-- Referral -->
        <div>
          <label for="referral" class="block mb-1 font-semibold">How did you know about our school?</label>
          <input type="text" id="referral" name="referral" class="w-full border px-4 py-2 rounded" />
        </div>

        <!-- Submit -->
        <div class="col-span-2 pt-4">
          <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded">
            Submit
          </button>
        </div>
      </form>
    </div>
  </section>

  <!-- Success Modal -->
  <div id="submitSuccessModal"
      class="fixed inset-0 z-[100] hidden"
      aria-hidden="true">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/60"></div>

    <!-- Dialog -->
    <div role="dialog" aria-modal="true" aria-labelledby="submitSuccessTitle"
        class="relative mx-auto mt-32 w-[92%] max-w-lg rounded-2xl bg-white p-8 text-center shadow-2xl">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
          class="mx-auto mb-4 h-14 w-14 text-green-600">
        <path fill="currentColor" d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2m-1 15l-5-5l1.414-1.414L11 13.172l6.586-6.586L19 8z"/>
      </svg>
      <h3 id="submitSuccessTitle" class="text-2xl font-bold text-gray-900">Thanks! Your enquiry was submitted.</h3>
      <p class="mt-2 text-gray-600">Our Admissions Team will contact you shortly.</p>
      <button type="button"
              id="closeSuccessModal"
              class="mt-6 inline-flex items-center justify-center rounded-lg bg-blue-600 px-6 py-2 font-semibold text-white hover:bg-blue-700">
        Close
      </button>
    </div>
  </div>

  <!-- Error Modal (fallback) -->
  <div id="submitErrorModal"
      class="fixed inset-0 z-[100] hidden"
      aria-hidden="true">
    <div class="absolute inset-0 bg-black/60"></div>
      <div role="dialog" aria-modal="true" aria-labelledby="submitErrorTitle"
          class="relative mx-auto mt-32 w-[92%] max-w-lg rounded-2xl bg-white p-8 text-center shadow-2xl">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"
            class="mx-auto mb-4 h-14 w-14 text-red-600">
              <path fill="currentColor" d="M128 24a104 104 0 1 0 104 104A104.117 104.117 0 0 0 128 24m0 152a12 12 0 1 1 12-12a12 12 0 0 1-12 12m12-52a12 12 0 0 1-24 0V80a12 12 0 0 1 24 0Z"/>
          </svg>
      <h3 id="submitErrorTitle" class="text-2xl font-bold text-gray-900">Submission failed</h3>
      <p class="mt-2 text-gray-600">Please try again. If the problem persists, contact the school.</p>
      <button type="button"
            id="closeErrorModal"
            class="mt-6 inline-flex items-center justify-center rounded-lg bg-gray-800 px-6 py-2 font-semibold text-white hover:bg-gray-900">
            Close
      </button>
    </div>
  </div>

  <!-- Footer partial -->
  <div hx-get="partials/footer.html" hx-trigger="load" hx-swap="outerHTML"></div>

  <!-- Inline script (move to assets/script.js if you prefer) -->
  <script>
  (function () {
    const form = document.getElementById('admissionsForm');
    if (!form) return;

    const successModal = document.getElementById('submitSuccessModal');
    const errorModal   = document.getElementById('submitErrorModal');
    const closeSuccess = document.getElementById('closeSuccessModal');
    const closeError   = document.getElementById('closeErrorModal');

    // Helpers: modal controls
    function openModal(el) {
      el.classList.remove('hidden');
      el.setAttribute('aria-hidden', 'false');
      const btn = el.querySelector('button');
      if (btn) btn.focus();
    }
    function closeModal(el) {
      el.classList.add('hidden');
      el.setAttribute('aria-hidden', 'true');
    }

    closeSuccess?.addEventListener('click', () => closeModal(successModal));
    closeError?.addEventListener('click', () => closeModal(errorModal));

    // Backdrop click closes modal
    successModal?.addEventListener('click', (e) => { if (e.target === successModal) closeModal(successModal); });
    errorModal?.addEventListener('click', (e) => { if (e.target === errorModal) closeModal(errorModal); });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (!successModal.classList.contains('hidden')) closeModal(successModal);
        if (!errorModal.classList.contains('hidden')) closeModal(errorModal);
      }
    });

    let isSubmitting = false;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (isSubmitting) return;

      // Honeypot
      const honey = form.querySelector('input[name="bot-field"]');
      if (honey && honey.value.trim() !== '') {
        // Bot detected: silently exit
        return;
      }

      // Button UX
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalBtnText = submitBtn ? submitBtn.textContent : '';
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
      }
      isSubmitting = true;

      try {
        const formData = new FormData(form);
        // Ensure Netlify sees the form name in the body
        if (!formData.get('form-name')) {
          const hidden = form.querySelector('input[name="form-name"]');
          formData.set('form-name', hidden?.value || form.getAttribute('name') || 'admissions-enquiry');
        }

        // Encode as x-www-form-urlencoded for Netlify static forms
        const encoded = new URLSearchParams(formData).toString();

        const res = await fetch('/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: encoded
        });

        if (res.ok) {
          form.reset();
          openModal(successModal);
        } else {
          console.error('Netlify submit failed:', res.status, await res.text().catch(() => ''));
          openModal(errorModal);
        }
      } catch (err) {
        console.error('Netlify submit error:', err);
        openModal(errorModal);
      } finally {
        isSubmitting = false;
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = originalBtnText;
        }
      }
    });
  })();
  </script>
</body>
</html>
